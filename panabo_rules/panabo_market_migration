CREATE TABLE `tmp_attr_rate` (
  `objid` varchar(50) NOT NULL,
  `rate` decimal(16,2) DEFAULT NULL,
  `mode` varchar(50) DEFAULT NULL,
  PRIMARY KEY (`objid`)
) ENGINE=InnoDB DEFAULT CHARSET=utf8;

update tmp_attr_rate 
SET rate = replace( substr(objid, 2 ), ',', '')
where substr(objid, 1, 1 ) IN ('D','M');

UPDATE market_rentalunit mu, market_rentalunit_attribute mra, tmp_attr_rate ta 
SET mu.rate = ta.rate, mu.paymentmode = ta.mode
where mu.objid = mra.unitid 
and mra.attributeid = ta.objid;

UPDATE market_rentalunit SET paymentmode = 'DAILY' WHERE paymentmode = 'DAY';
UPDATE market_rentalunit SET paymentmode = 'MONTHLY' WHERE paymentmode = 'MONTH';

insert into market_account_rate (objid,acctid,effectivedate,rate,paymentmode) 
SELECT 
ma.objid, ma.objid AS acctid, 
IFNULL( DATE_ADD(ma.nextbilldate, INTERVAL -1 DAY), '2016-01-01'), mu.rate, mu.paymentmode  
FROM market_account ma 
INNER JOIN market_rentalunit mu ON ma.unitid = mu.objid 